const ninja = [
    {
        name: 'Naruto',
        type: 'unknown',
        hp: 564,
        img: 'https://res.cloudinary.com/digaox5o1/image/upload/v1611014924/naruto_jrwlvd.png',
        attacks: [
            {
                name: "Clone Lasso",
                maxDamage: 40,
                minDamage: 20,
                maxCount: 100,
            },
            {
                name: "Rasengan",
                maxDamage: 60,
                minDamage: 45,
                maxCount: 6,
            },
            {
                name: "Rasenshuriken",
                maxDamage: 75,
                minDamage: 60,
                maxCount: 4,
            },
            {
                name: "Twin Rasenshuriken",
                maxDamage: 160,
                minDamage: 130,
                maxCount: 2,
            }
        ]
    },
    {
        img: 'https://res.cloudinary.com/digaox5o1/image/upload/v1611014890/gaara_pnzqeo.png',
        name: 'Gaara',
        type: 'unknown',
        hp: 282,
        attacks: [
            {
                name: "Sand Shield",
                maxDamage: 40,
                minDamage: 20,
                maxCount: 100,
            },
            {
                name: "Sand Swords",
                maxDamage: 60,
                minDamage: 45,
                maxCount: 6,
            },
            {
                name: "Sand Shuriken",
                maxDamage: 75,
                minDamage: 60,
                maxCount: 4,
            },
            {
                name: "Sand Clone",
                maxDamage: 130,
                minDamage: 110,
                maxCount: 2,
            }
        ]
    },
    {
        img: 'https://res.cloudinary.com/digaox5o1/image/upload/v1611014890/ugito_jyfreh.png',
        name: 'Yugito Nii',
        type: 'unknown',
        hp: 294,
        attacks: [
            {
                name: "Fire Release",
                maxDamage: 40,
                minDamage: 20,
                maxCount: 100,
            },
            {
                name: "Mouse Attack",
                maxDamage: 60,
                minDamage: 45,
                maxCount: 6,
            },
            {
                name: "Attack Two-Tails",
                maxDamage: 75,
                minDamage: 60,
                maxCount: 4,
            },
            {
                name: "Massive Fireball",
                maxDamage: 130,
                minDamage: 110,
                maxCount: 2,
            }
        ]
    },
    {
        img: 'https://res.cloudinary.com/digaox5o1/image/upload/v1611014890/yagura_zzsd4e.png',
        name: 'Yagura Karatachi',
        type: 'unknown',
        hp: 292,
        attacks: [
            {
                name: "Water Release",
                maxDamage: 40,
                minDamage: 20,
                maxCount: 100,
            },
            {
                name: "Summoning Technique",
                maxDamage: 60,
                minDamage: 45,
                maxCount: 6,
            },
            {
                name: "Water Mirrors",
                maxDamage: 75,
                minDamage: 60,
                maxCount: 4,
            },
            {
                name: "Strong Gust",
                maxDamage: 130,
                minDamage: 110,
                maxCount: 2,
            }
        ]
    },
    {
        img: 'https://res.cloudinary.com/digaox5o1/image/upload/v1611014890/roshi_f0op22.png',
        name: 'Rōshi',
        type: 'unknown',
        hp: 284,
        attacks: [
            {
                name: "Earth Release",
                maxDamage: 40,
                minDamage: 20,
                maxCount: 100,
            },
            {
                name: "Kekkei Genkai",
                maxDamage: 60,
                minDamage: 45,
                maxCount: 6,
            },
            {
                name: "Lava Release",
                maxDamage: 75,
                minDamage: 60,
                maxCount: 4,
            },
            {
                name: "Tailed Beast Ball",
                maxDamage: 130,
                minDamage: 110,
                maxCount: 2,
            }
        ]
    },
    {
        img: 'https://res.cloudinary.com/digaox5o1/image/upload/v1611014890/khan_nfpqsh.png',
        name: 'Han',
        type: 'unknown',
        hp: 404,
        attacks: [
            {
                name: "Boil Release",
                maxDamage: 40,
                minDamage: 20,
                maxCount: 100,
            },
            {
                name: "Erupting Propulsion Fist",
                maxDamage: 60,
                minDamage: 45,
                maxCount: 6,
            },
            {
                name: "Five-Mountain Jumpe",
                maxDamage: 75,
                minDamage: 60,
                maxCount: 4,
            },
            {
                name: "Tailed Beast Ball",
                maxDamage: 121,
                minDamage: 97,
                maxCount: 2,
            }
        ]
    },
    {
        img: 'https://res.cloudinary.com/digaox5o1/image/upload/v1611014890/utakata_cx4e85.png',
        name: 'Utakata',
        type: 'unknown',
        hp: 300,
        attacks: [
            {
                name: "Soap Bubble Ninjutsu",
                maxDamage: 40,
                minDamage: 20,
                maxCount: 100,
            },
            {
                name: "Leech Gap",
                maxDamage: 60,
                minDamage: 45,
                maxCount: 6,
            },
            {
                name: "Wild Water Wave",
                maxDamage: 75,
                minDamage: 60,
                maxCount: 4,
            },
            {
                name: "Wisdom Wolf Decay",
                maxDamage: 130,
                minDamage: 110,
                maxCount: 2,
            }
        ]
    },
    {
        img: 'https://res.cloudinary.com/digaox5o1/image/upload/v1611014891/fuu_br2sjx.png',
        name: 'Fū',
        type: 'unknown',
        hp: 280,
        attacks: [
            {
                name: "Cocoon",
                maxDamage: 40,
                minDamage: 20,
                maxCount: 100,
            },
            {
                name: "Bug Bite",
                maxDamage: 60,
                minDamage: 45,
                maxCount: 6,
            },
            {
                name: "Scale Powder",
                maxDamage: 75,
                minDamage: 60,
                maxCount: 4,
            },
            {
                name: "Net-Shaped Prison",
                maxDamage: 145,
                minDamage: 115,
                maxCount: 2,
            }
        ]
    },
    {
        img: 'https://res.cloudinary.com/digaox5o1/image/upload/v1611014891/bi_gpzmra.png',
        name: 'Killer B',
        type: 'unknown',
        hp: 385,
        attacks: [
            {
                name: "Headbutt",
                maxDamage: 40,
                minDamage: 20,
                maxCount: 100,
            },
            {
                name: "Liger Bomb",
                maxDamage: 60,
                minDamage: 45,
                maxCount: 6,
            },
            {
                name: "Octopus Hug",
                maxDamage: 75,
                minDamage: 60,
                maxCount: 4,
            },
            {
                name: "Rising Bomber",
                maxDamage: 125,
                minDamage: 100,
                maxCount: 1,
            }
        ]
    },
    {
        img: 'https://res.cloudinary.com/digaox5o1/image/upload/v1611014891/khagomoro_drso04.png',
        name: 'Madara Uchiha',
        type: 'unknown',
        hp: 390,
        attacks: [
            {
                name: "Izanagi",
                maxDamage: 40,
                minDamage: 20,
                maxCount: 100,
            },
            {
                name: "Susanoo",
                maxDamage: 60,
                minDamage: 45,
                maxCount: 6,
            },
            {
                name: "Yasaka Magatama",
                maxDamage: 75,
                minDamage: 60,
                maxCount: 4,
            },
            {
                name: "Truth-Seeking Ball",
                maxDamage: 180,
                minDamage: 95,
                maxCount: 1,
            }
        ]
    }
];

const logs = [
    '[ПЕРСОНАЖ-№1] вспомнил что-то важное, но неожиданно [ПЕРСОНАЖ-№2], не помня себя от испуга, ударил в предплечье врага.',
    '[ПЕРСОНАЖ-№1] поперхнулся, и за это [ПЕРСОНАЖ-№2] с испугу приложил прямой удар коленом в лоб врага.',
    '[ПЕРСОНАЖ-№1] забылся, но в это время наглый [ПЕРСОНАЖ-№2], приняв волевое решение, неслышно подойдя сзади, ударил.',
    '[ПЕРСОНАЖ-№1] пришел в себя, но неожиданно [ПЕРСОНАЖ-№2] случайно нанес мощнейший удар.',
    '[ПЕРСОНАЖ-№1] поперхнулся, но в это время [ПЕРСОНАЖ-№2] нехотя раздробил кулаком \<вырезанно цензурой\> противника.',
    '[ПЕРСОНАЖ-№1] удивился, а [ПЕРСОНАЖ-№2] пошатнувшись влепил подлый удар.',
    '[ПЕРСОНАЖ-№1] высморкался, но неожиданно [ПЕРСОНАЖ-№2] провел дробящий удар.',
    '[ПЕРСОНАЖ-№1] пошатнулся, и внезапно наглый [ПЕРСОНАЖ-№2] беспричинно ударил в ногу противника',
    '[ПЕРСОНАЖ-№1] расстроился, как вдруг, неожиданно [ПЕРСОНАЖ-№2] случайно влепил стопой в живот соперника.',
    '[ПЕРСОНАЖ-№1] пытался что-то сказать, но вдруг, неожиданно [ПЕРСОНАЖ-№2] со скуки, разбил бровь сопернику.'
];

// МАССИВ С ГЕРОЯМИ

function renderNormalHero(ninjaData) {
    let normalHero = document.querySelector('#normal-card-template').content.cloneNode(true);
    let normalHeroPhoto = normalHero.querySelector('.card__image');
    normalHeroPhoto.src = ninjaData.img;
    normalHeroPhoto.alt = ninjaData.name;
    let normalHeroName = normalHero.querySelector('.card__name');
    normalHeroName.textContent = ninjaData.name;
    let normalHeroHP = normalHero.querySelector('#hero-hp');
    normalHeroHP.textContent = ninjaData.hp;
    let normalHeroAttack = normalHero.querySelector('#hero-attack');
    normalHeroAttack.textContent = '100';
    let normalHeroHPText = normalHero.querySelector('#health-character');
    normalHeroHPText.textContent = `${ninjaData.hp} / ${ninjaData.hp}`;
    return normalHero;
}

function insertNormalHeroToHTML(card) {
    document.querySelector('.playground').prepend(card);
}

function renderDarkHero(ninjaData) {
    let darkHero = document.querySelector('#dark-card-template').content.cloneNode(true);
    let darkHeroPhoto = darkHero.querySelector('.card__image');
    darkHeroPhoto.src = ninjaData.img;
    darkHeroPhoto.alt = ninjaData.name;
    let darkHeroName = darkHero.querySelector('.card__name');
    darkHeroName.textContent = ninjaData.name;
    let darkHeroHP = darkHero.querySelector('#hero-hp');
    darkHeroHP.textContent = ninjaData.hp;
    let darkHeroAttack = darkHero.querySelector('#hero-attack');
    darkHeroAttack.textContent = '100';
    let darkHeroHPText = darkHero.querySelector('#health-character');
    darkHeroHPText.textContent = `${ninjaData.hp} / ${ninjaData.hp}`;
    return darkHero;
}

function insertDarkHeroToHTML(card) {
    document.querySelector('.playground').append(card);
}

const firstNinjaNumber = getRandomInt(0, ninja.length);
let secontNinjaNumber = getRandomInt(0, ninja.length);
while(firstNinjaNumber === secontNinjaNumber) {
    secontNinjaNumber = getRandomInt(0, ninja.length);
}

insertNormalHeroToHTML(renderNormalHero(ninja[firstNinjaNumber]));
insertDarkHeroToHTML(renderDarkHero(ninja[secontNinjaNumber]));
renderAttack(ninja[firstNinjaNumber], ninja[secontNinjaNumber]);

function getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min)) + min; //Максимум не включается, минимум включается
}

function renderAttack(firstNinjaData, secondNinjaData) {

    let firstCounter = firstNinjaData.attacks[0].maxCount;
    let secondCounter = firstNinjaData.attacks[1].maxCount;
    let thirdCounter = firstNinjaData.attacks[2].maxCount;
    let fourthCounter = firstNinjaData.attacks[3].maxCount;

    const firstAttackButton = document.querySelector('#btn-kick-1');
    firstAttackButton.textContent = firstNinjaData.attacks[0].name + ` x${firstCounter}`;

    const secondAttackButton = document.querySelector('#btn-kick-2');
    secondAttackButton.textContent = firstNinjaData.attacks[1].name + ` x${secondCounter}`;

    const thirdAttackButton = document.querySelector('#btn-kick-3');
    thirdAttackButton.textContent = firstNinjaData.attacks[2].name + ` x${thirdCounter}`;

    const fourthAttackButton = document.querySelector('#btn-kick-4');
    fourthAttackButton.textContent = firstNinjaData.attacks[3].name + ` x${fourthCounter}`;

    let enemyTotalHP = Number(document.querySelector('.enemy #hero-hp').textContent);
    let enemyHP = document.querySelector('.enemy #health-character');
    let enemyRemainingHp = enemyTotalHP;

    let heroTotalHP = Number(document.querySelector('.character #hero-hp').textContent);
    let heroHP = document.querySelector('.character #health-character');
    let heroRemainingHp = heroTotalHP;

    let logCounter = 1;

    // первая атака
    firstAttackButton.addEventListener('click', () => {
        // наш удар
        let damage = getRandomInt(firstNinjaData.attacks[0].minDamage, firstNinjaData.attacks[0].maxDamage + 1);
        if(enemyRemainingHp >= 0) {
            enemyRemainingHp = enemyRemainingHp - damage;
            if(enemyRemainingHp < 0) {
                enemyRemainingHp = 0;
            }
            enemyHP.textContent = `${enemyRemainingHp} / ${enemyTotalHP}`;
            renderHPBar(true);
            generateLog(damage, false);
            setTimeout(deleteOldLog, 5000);
            if(enemyRemainingHp === 0 && heroRemainingHp > 0) {
                alert('You Win');
                firstAttackButton.setAttribute('disabled', 0);
                secondAttackButton.setAttribute('disabled', 0);
                thirdAttackButton.setAttribute('disabled', 0);
                fourthAttackButton.setAttribute('disabled', 0);
            }
        }
        attackCounter(1);
        // ответный удар
        damage = getRandomInt(secondNinjaData.attacks[0].minDamage, secondNinjaData.attacks[0].maxDamage + 1);
        if(heroRemainingHp >= 0) {
            heroRemainingHp = heroRemainingHp - damage;
            if(heroRemainingHp < 0) {
                heroRemainingHp = 0;
            }
            heroHP.textContent = `${heroRemainingHp} / ${heroTotalHP}`;
            renderHPBar(false);
            generateLog(damage, true);
            setTimeout(deleteOldLog, 7000);
            if(heroRemainingHp === 0 && enemyRemainingHp > 0) {
                alert('You Lose');
                firstAttackButton.setAttribute('disabled', 0);
                secondAttackButton.setAttribute('disabled', 0);
                thirdAttackButton.setAttribute('disabled', 0);
                fourthAttackButton.setAttribute('disabled', 0);
            }
        }
    });
    
    // вторая атака
    secondAttackButton.addEventListener('click', () => {
        // наш удар
        let damage = getRandomInt(firstNinjaData.attacks[1].minDamage, firstNinjaData.attacks[1].maxDamage + 1);
        if(enemyRemainingHp >= 0) {
            enemyRemainingHp = enemyRemainingHp - damage;
            if(enemyRemainingHp < 0) {
                enemyRemainingHp = 0;
            }
            enemyHP.textContent = `${enemyRemainingHp} / ${enemyTotalHP}`;
            renderHPBar(true);
            generateLog(damage, false);
            setTimeout(deleteOldLog, 5000);
            if(enemyRemainingHp === 0 && heroRemainingHp > 0) {
                alert('You Win');
                firstAttackButton.setAttribute('disabled', 0);
                secondAttackButton.setAttribute('disabled', 0);
                thirdAttackButton.setAttribute('disabled', 0);
                fourthAttackButton.setAttribute('disabled', 0);
            }
        }
        attackCounter(2);
        // ответный удар
        damage = getRandomInt(secondNinjaData.attacks[0].minDamage, secondNinjaData.attacks[0].maxDamage + 1);
        if(heroRemainingHp >= 0) {
            heroRemainingHp = heroRemainingHp - damage;
            if(heroRemainingHp < 0) {
                heroRemainingHp = 0;
            }
            heroHP.textContent = `${heroRemainingHp} / ${heroTotalHP}`;
            renderHPBar(false);
            generateLog(damage, true);
            setTimeout(deleteOldLog, 7000);
            if(heroRemainingHp === 0 && enemyRemainingHp > 0) {
                alert('You Lose');
                firstAttackButton.setAttribute('disabled', 0);
                secondAttackButton.setAttribute('disabled', 0);
                thirdAttackButton.setAttribute('disabled', 0);
                fourthAttackButton.setAttribute('disabled', 0);
            }
        }
    });

    // третья атака
    thirdAttackButton.addEventListener('click', () => {
        // наш удар
        let damage = getRandomInt(firstNinjaData.attacks[2].minDamage, firstNinjaData.attacks[2].maxDamage + 1);
        if(enemyRemainingHp >= 0) {
            enemyRemainingHp = enemyRemainingHp - damage;
            if(enemyRemainingHp < 0) {
                enemyRemainingHp = 0;
            }
            enemyHP.textContent = `${enemyRemainingHp} / ${enemyTotalHP}`;
            renderHPBar(true);
            generateLog(damage, false);
            setTimeout(deleteOldLog, 5000);
            if(enemyRemainingHp === 0 && heroRemainingHp > 0) {
                alert('You Win');
                firstAttackButton.setAttribute('disabled', 0);
                secondAttackButton.setAttribute('disabled', 0);
                thirdAttackButton.setAttribute('disabled', 0);
                fourthAttackButton.setAttribute('disabled', 0);
            }
        }
        attackCounter(3);
        // ответный удар
        damage = getRandomInt(secondNinjaData.attacks[0].minDamage, secondNinjaData.attacks[0].maxDamage + 1);
        if(heroRemainingHp >= 0) {
            heroRemainingHp = heroRemainingHp - damage;
            if(heroRemainingHp < 0) {
                heroRemainingHp = 0;
            }
            heroHP.textContent = `${heroRemainingHp} / ${heroTotalHP}`;
            renderHPBar(false);
            generateLog(damage, true);
            setTimeout(deleteOldLog, 7000);
            if(heroRemainingHp === 0 && enemyRemainingHp > 0) {
                alert('You Lose');
                firstAttackButton.setAttribute('disabled', 0);
                secondAttackButton.setAttribute('disabled', 0);
                thirdAttackButton.setAttribute('disabled', 0);
                fourthAttackButton.setAttribute('disabled', 0);
            }
        }
    });

    // четвертая атака
    fourthAttackButton.addEventListener('click', () => {
        // наш удар
        let damage = getRandomInt(firstNinjaData.attacks[3].minDamage, firstNinjaData.attacks[3].maxDamage + 1);
        if(enemyRemainingHp >= 0) {
            enemyRemainingHp = enemyRemainingHp - damage;
            if(enemyRemainingHp < 0) {
                enemyRemainingHp = 0;
            }
            enemyHP.textContent = `${enemyRemainingHp} / ${enemyTotalHP}`;
            renderHPBar(true);
            generateLog(damage, false);
            setTimeout(deleteOldLog, 5000);
            if(enemyRemainingHp === 0 && heroRemainingHp > 0) {
                alert('You Win');
                firstAttackButton.setAttribute('disabled', 0);
                secondAttackButton.setAttribute('disabled', 0);
                thirdAttackButton.setAttribute('disabled', 0);
                fourthAttackButton.setAttribute('disabled', 0);
            }
        }
        attackCounter(4);
        // ответный удар
        damage = getRandomInt(secondNinjaData.attacks[0].minDamage, secondNinjaData.attacks[0].maxDamage + 1);
        if(heroRemainingHp >= 0) {
            heroRemainingHp = heroRemainingHp - damage;
            if(heroRemainingHp < 0) {
                heroRemainingHp = 0;
            }
            heroHP.textContent = `${heroRemainingHp} / ${heroTotalHP}`;
            renderHPBar(false);
            generateLog(damage, true);
            setTimeout(deleteOldLog, 7000);
            if(heroRemainingHp === 0 && enemyRemainingHp > 0) {
                alert('You Lose');
                firstAttackButton.setAttribute('disabled', 0);
                secondAttackButton.setAttribute('disabled', 0);
                thirdAttackButton.setAttribute('disabled', 0);
                fourthAttackButton.setAttribute('disabled', 0);
            }
        }
    });

    function attackCounter(attack) {
        switch(attack) {
            case 1:
                firstCounter -= 1;
                firstAttackButton.textContent = firstNinjaData.attacks[0].name + ` x${firstCounter}`;
            break;
            
            case 2:
                secondCounter -= 1;
                secondAttackButton.textContent = firstNinjaData.attacks[1].name + ` x${secondCounter}`;
            break;

            case 3:
                thirdCounter -= 1;
                thirdAttackButton.textContent = firstNinjaData.attacks[2].name + ` x${thirdCounter}`;
            break;

            case 4:
                fourthCounter -= 1;
                fourthAttackButton.textContent = firstNinjaData.attacks[3].name + ` x${fourthCounter}`;
            break;
        }

        if(firstCounter === 0) {
            firstAttackButton.setAttribute('disabled', 0);
        }
        
        if(secondCounter === 0) {
            secondAttackButton.setAttribute('disabled', 0);
        }

        if(thirdCounter === 0) {
            thirdAttackButton.setAttribute('disabled', 0);
        }

        if(fourthCounter === 0) {
            fourthAttackButton.setAttribute('disabled', 0);
        }
    }

    function renderHPBar(enemy) {
        if(enemy === false) {
            let heroHPPerCent = heroTotalHP / 100;
            let hpBar = document.querySelector('.character #progressbar-character');
            hpBar.setAttribute('style', `width: ${heroRemainingHp / heroHPPerCent}%;`);
        } else {
            let enemyHPPerCent = enemyTotalHP / 100;
            let hpBar = document.querySelector('.enemy #progressbar-character');
            hpBar.setAttribute('style', `width: ${enemyRemainingHp / enemyHPPerCent}%;`);
        }
    }

    function generateLog(damage, enemy) {
        const logsElement = document.querySelector('.logs');
        let logText = logs[getRandomInt(0, logs.length)];
        logArr = logText.split(' ');
        let a = logArr.indexOf('[ПЕРСОНАЖ-№1]');
        let b = logArr.indexOf('[ПЕРСОНАЖ-№2]');
        if(b === -1) {
            b = logArr.indexOf('[ПЕРСОНАЖ-№2],');
        }
        if(enemy === true) {
            logArr.splice(a, 1, firstNinjaData.name);
            logArr.splice(b, 1, secondNinjaData.name);
            logArr.unshift(`#${logCounter}:`);
            logArr.push(`-${damage},`);
            logArr.push(`[${`${heroRemainingHp}/${heroTotalHP}`}]`);
        } else {
            logArr.splice(a, 1, secondNinjaData.name);
            logArr.splice(b, 1, firstNinjaData.name);
            logArr.unshift(`#${logCounter}:`);
            logArr.push(`-${damage},`);
            logArr.push(`[${`${enemyRemainingHp}/${enemyTotalHP}`}]`);
        }
        logText = logArr.join(' ');
        let logTemplate = document.createElement('p');
        logTemplate.classList.add('logs__text');
        logTemplate.textContent = logText;
        logsElement.append(logTemplate);
        logCounter++;
    }

    function deleteOldLog() {
        const logsElement = document.querySelector('.logs');
        logsElement.querySelector('.logs__text').remove();
    }
}